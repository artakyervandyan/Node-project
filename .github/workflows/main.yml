on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

env:
  AWS_REGION: "eu-central-1"                   # set this to your preferred AWS region, e.g. us-west-1
  ECR_REPOSITORY: "891376922010.dkr.ecr.eu-central-1.amazonaws.com/ci_from_github"           # set this to your Amazon ECR repository name

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}

    - name: Build Docker Image
      run: docker build -t my_nodejs
    - name:  Push to ECR
      uses: mr-smithers-excellent/docker-build-push@v6
      with:
        image: my_nodejs
        registry: ${{env.ECR_REPOSITORY}}
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
